{% extends 'account/detail_student.html' %}
{% load static %}
{% load item_tags %}
{% load widget_tweaks %}


{% block require %}
    <script src="{% static 'js/require.js' %}" data-main="{% static 'js/common4.js' %}"></script> 
    <script>
        require(['script/ajax-group']);
    </script>

 

{% endblock %}

 




 
                 

{% block datae %} 
<style>

.table > thead > tr > th, .table > tbody > tr > th, .table > tfoot > tr > th, .table > thead > tr > td, .table > tbody > tr > td, .table > tfoot > tr > td {
    padding: 5px;
    line-height: 1.42857143;
    border-top: 1px solid #ddd;
}
</style>
 

{% if knowledges|length > 0 %}
<div class="row">
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <table class="table table-bordered table-hover standard_tab_sort300">
                <tbody>
                    <tr>
                        <td>
                            <h2> Suivi par savoir faire


                        </h2> 
                        </td>
                        <td>
                             Dernière connexion : {{ student.user.last_login|date:"d N Y, H:i"  }}



                                {% if teacher %}
                                <small>
                                    <a href="#" data-toggle='modal' class="pull-right btn btn-danger"
                                                data-target='#writer'  
                                                class="send_message" >  
                                        Ecrire un message à {{ student.user }}
                                    </a>
                                </small>
                                {% endif %}


                             
                        </td>
                    </tr>    
                    <tr>
                        <td colspan="2">
                            {% with student.resultknowledge_dict as results %}

                            {% for knowledge in knowledges %}
                                {% get_score2 results knowledge.pk  as score %}

                                {% if score != "" %}
                                    <a class="markdown  square
                                            {% if score < 30 %}
                                             red 
                                            {% elif score < 60 %}
                                            orange
                                            {% elif score < 80 %}
                                            green
                                            {% else %}
                                            darkgreen
                                            {% endif %}"
                                          href="#" data-container="body"
                                          data-toggle="popover"  
                                          data-trigger="hover" data-placement="bottom"
                                          title="{{ knowledge}}"
                                          data-content="{% for e in knowledge.exercises.all %}{% if e.supportfile.title %} {{ e.supportfile.title|cleanhtml|capfirst }} {% else %} {{ e.supportfile.annoncement|cleanhtml }} {% endif %} {% if not forloop.last %}  +  {% endif %}{% endfor %}">
                                        {{ score }}
                                    </a>
                                {% else %}
                                    <a class="markdown square"                                                   
                                          href="#" data-container="body"
                                          data-toggle="popover" 
                                          data-trigger="hover"
                                           data-placement="bottom" 
                                          data-content="{{ knowledge.name }}"> 
                                          {{ score }}
                                    </a>
                                {% endif %}
                            {% endfor %}
                            {% endwith %}
                        </td>
                    </tr>
                    <tr class="no_padding">
                        <td colspan="2">
                            <h2> Suivi par exercices 
                                <small class="thin">Si un exercice est effectué plusieurs fois, le dernier score est affiché ici. 
                                <a href="{% url 'detail_student' student.user.id %}"   target="_blank"  style="font-size:18px;font-weight: 400"> <i class="fa fa-angle-double-right" style="font-size:12px;"></i> Voir le suivi par exercices</a>.
                                </small>

                            </h2> 
                        </td>
                    </tr> 
                    {% regroup knowledges by theme as theme_list %}
                    {% for thme in theme_list %}
                    <tr>
                        <td>     
                            {{ thme.grouper }}        
                        </td>
                        <td>  
                            {%  get_resultexercises_by_theme student thme.grouper as resultexercises %}  


                            {% for resultexercise in resultexercises %}  
                                {% get_score resultexercise.exercise student as score %} 

                                {% if score %}
                                <a class="markdown square
                                        {% if score < 30 %}
                                         red 
                                        {% elif score < 60 %}
                                        orange
                                        {% elif score < 80 %}
                                        green
                                        {% else %}
                                        darkgreen
                                        {% endif %}"
                                      href="{% url 'show_this_exercise'  resultexercise.exercise.id   %}" data-container="body"
                                      data-toggle="popover" 
                                      data-trigger="hover" data-placement="top"
                                      data-content="{{ resultexercise.exercise.knowledge.name }}">
                                    {{ score }}
                                </a>
                                {% else %}
                                    <a class="markdown square"                                                   
                                          href="{% url 'show_this_exercise' resultexercise.exercise.id %}" data-container="body"
                                          data-toggle="popover"
                                          data-trigger="hover"
                                          data-placement="top"
                                          data-content="{{ resultexercise.exercise.knowledge.name }}"> 
                                          {{ score }}
                                    </a>
                                {% endif %}                                           
                            {% endfor %}  
                        </td>
                    </tr>
                    {% endfor %}   
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12 col-md-12">
            <table class="table table-bordered table-hover">
                <tbody>
                    <tr>
                        <td>
                            Exercices faits <span class="pull-right">{{ std.nb_exo  }}</span>
                        </td>
                        <td>
                            Score moyen  <span class="pull-right">{{ std.average_score  }}</span> 
                        </td>
                        <td>
                            Score médian  <span class="pull-right">{{ std.median  }}</span> 
                        </td>
                        <td> 
                            Durée totale  <span class="pull-right">{{ std.duration|time_done  }}</span> 
                        </td>
                    </tr>  
                    <tr>
                        <td>
                            Tâches à rendre <span class="pull-right">{{ std.nb  }}</span>
                        </td>
                        <td>
                            Tâches remises   <span class="pull-right">{% if std.done  > 0 %} <span class="label label-success">{{ std.done  }}</span>{% else %}{{ std.done  }}{% endif %}</span> 
                        </td>
                        <td>
                            Tâches non remises <span class="pull-right">{% if std.no_done  > 0 %} <span class="label label-danger">{{ std.no_done  }}</span>{% else %}{{ std.no_done  }}{% endif %}</span> 
                        </td>
                        <td> 
                            Tâches remises en retard <span class="pull-right">{% if std.late  > 0 %} <span class="label label-warning">{{ std.late  }}</span>{% else %}{{ std.late }}{% endif %}</span> 
                        </td>
                    </tr>    
                </tbody>
            </table>
        </div>
    </div> 
    <div class="row">
        <div class="col-sm-12 col-md-12">     
                <a href="javascript:history.back()"  class="btn btn-default " >Retour </a>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="row">

            <div class="col-md-12 col-lg-12 col-sm-12" style="text-align: center">
                <div class="alert alert-info">
                    <h1 class="thin"> Aucun exercice n'est proposé à cet élève.</h1>
                    <div style="border-radius: 50%;width:250px;height:250px; margin-right: auto; margin-left: auto; background-color: #FFF;text-align: center">
                        <img src="{% static 'img/sacado_color.png' %}"   />  
                    </div>
                </div>
            </div>

    </div>
</div>
{% endif  %}   


{% if request.user.user_type == 2 %}  
    <div class="modal fade" id="writer" tabindex="-1" role="dialog" aria-labelledby="writer" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>                
                    <h5 class="modal-title" >Ecrire un message à  <span id="modal_student_name"></span></h5>
                </div>
                <div class="modal-body">
                    <form  method="POST" > 
                          {% csrf_token %}
                        <div class="form-group"><input type="hidden" name="student_id" value="{{ student.user.id }}" id="student_id"/>
                          <input type="text" name="name" class="form-control" id="name" placeholder="Nom" value="{{ student.user }}" />
                        </div>
                        <div class="form-group">
                          <input type="email" class="form-control" name="email" id="email" placeholder="Email" value="{{ student.user.email }}" />
                        </div>
                        <div class="form-group">
                            {{ form.subject|add_class:"form-control"|attr:"placeholder:Objet"|attr:"required" }}
                        </div>
                        <div class="form-group">
                            {{ form.texte|attr:"required"  }}
                        </div>
                        <div class="text-center">
                            <button type="submit" class="btn btn-primary" id="sender_message">Envoyer</button>   
                            <a href="#"  class="btn btn-default" class="close" data-dismiss="modal" aria-label="Close">Retour</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div> 
{% endif %}


{% endblock %}