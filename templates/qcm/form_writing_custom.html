{% extends 'dashboard.html' %}
{% load static %}
{% load widget_tweaks %}
{% load item_tags %}


{% block require %}
    <script src="{% static 'js/require.js' %}"   data-main="{% static 'js/common4.js' %}"></script>
    <script>
        require(['script/ajax-exercise']);
    </script> 
    
{% endblock %}

 

{% block page_title %}
    <span style="color:{{ parcours.color  }}"><i class="fa fa-desktop"></i> {{ parcours }} <img src="{% static 'img/angle-right.png' %}"/><small> Exercice corrigé par votre enseignant</small></span>  
{% endblock %}


{% block page_menu_right %}

{% endblock %}




{% block css_files %}
{% endblock %}


{% block body %}
<section class="content_main"> 
    <div class="row">
        <div class="col-sm-12 col-md-12 col-lg-8">
            {% if customexercise.customexercise_remediation.all|length > 0 %}
            <span class="pull-right">
                <label>Aides : </label>
                  {% for remediation in customexercise.customexercise_remediation.all %}
                      <a href="#" data-target="#remediation_viewer" data-remediation_id="{{ remediation.id }}" data-is_custom="1"  data-url="0" data-toggle='modal' class="white remediation_viewer btn btn-default">
                            {% include 'qcm/remediation_choices.html' %}
                      </a>
                  {% endfor  %} 
            </span>
            {% endif  %}

            {% if customexercise.instruction %}
            <a href="#" data-toggle='modal' data-target='#consigne' class="btn btn-danger">Lire la consigne</a><br/>
            {% endif  %}
            {% for remediation in customexercise.customexercise_remediation.all %}
                {% if remediation.consigne %}
                <audio controls>
                    <source src="{{ remediation.mediation.url }}" type="audio/mpeg">
                    <span class="text-danger">Votre navigateur ne lit pas l'audio.</span>
                </audio>
                {% endif %}
            {% endfor  %} 

            <hr>             
            <form action="" method="POST" enctype='multipart/form-data'>
                {% csrf_token %}
                {% if customexercise.is_image  %} 
                    <div class="col-sm-7 col-lg-7" >
                        <div class="alert alert-danger">
                            Insérer les images dans l'ordre des pages de votre copie. Merci.
                        </div>
                    {{ form_ans.management_form }}
                        <!-- Les formulaires du formset -->
                        <div id="formsetZone">
                            <div class="row" id="duplicate" style="display:none">            
                                <div class="col-sm-12 col-md-8">
                                        <div class="form-group">
                                            {{ form_ans.empty_form.image |add_class:"btn btn-default" }}
                                            {{ form_ans.empty_form.image.errors }}
                                        </div>

                                </div>    
                                <div class="col-sm-12 col-md-4">
                                        <div class="delete_button"></div>

                                </div>
                            </div>
                            {% for form in form_ans %}
                            <div class="row" id="duplicate{{ forloop.counter0 }}">            
                                <div class="col-sm-12 col-md-6">
                                    <div class="form-group">
                                        <label>{{ form.image.label_tag }}</label><br/>
                                        {{ form.image |add_class:"btn btn-default" }}
                                        {{ form.image.errors }}
                                    </div> 
                                 </div>
                            </div>
                            {% endfor %}

                        </div> 
                        <div class="row">
                            <div class="col-sm-6 col-md-6 controls">
                                <div class="form-group">
                                    <a href="#" id="new_item" class="btn btn-default add_more" ><i class="fa fa-plus"></i> Ajouter une image</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-5 col-lg-5">
                        {% for img in images %}
                            <div class="row" id="delete_custom_answer_image{{ img.id }}">
                                <a href="#" class="btn btn-danger delete_custom_answer_image" data-image_id="{{ img.id }}" data-custom=1 ><i class="fa fa-trash"></i></a>
                                <img src="{{ img.image.url }}" width="100%"/>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                {% if   customexercise.is_file  %}   
                    <div class="form-group">
                        {{ form.file.label_tag }}  <br>
                        {{ form.file|add_class:"btn btn-default"   }}
                        {{ form.file.errors }} <br>
                    </div> 
                {% endif %}
                {% if customexercise.is_text   %} 

                    <div class="form-group">
                        <label>Zone pour écrire</label><br>
                        {{ form.answer }}
                        {{ form.answer.errors }} <br>
                    </div>
                {% endif %}
                <div class="row">
                    <div class="col-sm-12 col-lg-8">
                        <div class="form-group">
                            {% get_all_results_custom customexercise student parcours.id as data %}                          
                            {% if data.point  %}
                                <h3>Note : {{ data.point }} <small>sur {{ customexercise.mark }}</small></h3>                             
                            {% endif  %}
                            {% if data.comment  %}
                                <h3>Commentaire :</h3>
                                 {{ data.comment }}                        
                            {% endif  %}
                            {% get_is_lock parcours today as is_lock %}                            
                            {% get_is_lock customexercise today as is_block %}
                            {% if not is_lock  %}
                                {% if not data.is_corrected and not is_block  %}
                                    <input value="Soumettre votre exercice" type="submit" class="btn btn-primary"/>
                                {% endif  %}
                            {% endif  %}
                                <hr/>
                                <input type="button" value="Annuler" onclick="javascript:history.back()"
                                                                       class="btn btn-default "/>                                       
                        </div>
                    </div>
                </div>
            </form> 
        </div>  
        <div class="col-sm-12 col-lg-4">
            {% if customexercise.is_scratch   %} 
            <label>Conseil :</label>  Utiliser le site Scratch pour créer votre script. Prendre une capture d'écran et la déposer dans la zone de texte.<br><br>
            <a href="https://scratch.mit.edu/projects/editor/?tutorial=getStarted" target="_blank">Naviguer vers Scratch <img src="{% static 'img/scratch.png' %}"/></a>
            <hr>  
            {% endif %} 
            {% if customexercise.skills.all|length > 0 %}              
                <label>Compétences visées :</label>
                {% for skill in customexercise.skills.all %}
                {% get_custom_score skill customexercise student parcours as custom_score %}
                    <li class="sans_puce">{{skill}} 
                         {% if custom_score == 4 %}<i class="fa fa-square text-primary"></i>
                         {% elif custom_score == 3 %}<i class="fa fa-square text-success"></i>
                         {% elif custom_score == 2 %}<i class="fa fa-square text-warning"></i>
                         {% elif custom_score == 1 %}<i class="fa fa-square text-danger"></i>                         
                         {% endif %}
                    </li>
                {% endfor %}
            {% endif %}
            {% if customexercise.skills.all|length > 0 and customexercise.knowledges.all|length > 0 %}
            <hr>
            {% endif %}
            {% if customexercise.knowledges.all|length > 0 %}                
            <label>Savoir faire évalués :</label>
            {% for knowledge in customexercise.knowledges.all %}
                {% get_custom_score knowledge customexercise student parcours as custom_score %}
                <li class="sans_puce">{{knowledge}}
                         {% if custom_score == 4 %}<i class="fa fa-square text-primary"></i>
                         {% elif custom_score == 3 %}<i class="fa fa-square text-success"></i>
                         {% elif custom_score == 2 %}<i class="fa fa-square text-warning"></i>
                         {% elif custom_score == 1 %}<i class="fa fa-square text-danger"></i>                         
                         {% endif %}
                </li>
            {% endfor %}
            {% endif %}
        </div>
    </div>        
</section>



<div class="modal fade" id="consigne" tabindex="-1" role="dialog" aria-labelledby="consigne">
    <div class="modal-dialog" role="document" >
        <div class="modal-content" style="padding-top :0px;">
            <div class="modal-header">
                <h3 class="sacado">Consigne
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> 
                </h3>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-12 col-xs-12">   
                        {{ customexercise.instruction|safe }} 
                    </div>   
                </div> 
            </div>
        </div>
    </div>
</div>



{% endblock %} 
 