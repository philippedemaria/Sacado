{% extends 'dashboard.html' %}
{% load widget_tweaks %}
{% load static %}
{% load item_tags %}

{% block require %}
 

    <script src="{% static 'js/require.js' %}"   data-main="{% static 'js/common3.js' %}"></script>

    <script>
        require(['script/ajax-parcours']);
        require(['script/ajax-quizz-complement']);
    </script> 
{% endblock %} 


 

{% block page_title %}

<span style="color:{{ parcours.color }}">  
    {% if parcours.is_folder %}
    <i class="fa fa-folder-open"></i>
    {% else %}
    <i class="fa fa-th"></i> 
    {% endif %}
</span>

    {% include 'qcm/breadcrumb.html' %}

{% if not parcours.is_folder %}
<small >{{ parcours.nb_exercises }} exercice{{ parcours.nb_exercises|pluralize }}</small> 
    {% endif %}

    {% if user.is_testeur or user.is_superuser %} 
        <a href="#" data-toggle='modal' data-target='#reporting'>
            <sup><i class="fa fa-comment fa-xs"></i></sup>
        </a>
    {% endif %} 
{% endblock %}




{% block page_menu_right %}

    {% include 'qcm/submenu_parcours.html' %}

{% endblock %}

 

{% block body %}

<style type="text/css">
#response_div{
    display:none;
}
body{
    overflow-x: hidden;
}


</style>

{% include 'preloader.html' %}
<div class="row" id="response_div">
    <div class="col-sm-12 col-md-12">
        <div class="alert alert-success" id="response">Votre commentaire audio est enregistré</div>
    </div>
</div>



<form action="" methode="POST">      
    <section class="content_list content_list_add exercise_sortable" id="miseEnAttenteDashboard">
     
     
    {% if parcours.stop %}

        {% if parcours.stop < today %}
        <div class="row" >
            <div class="col-sm-12 col-md-12">
                <div class="alert alert-danger" >{% if parcours.is_evaluation %}Cette évaluation est verrouillée {% else %}Ce parcours est verrouillé {% endif %} à partir du <b>{{ parcours.stop|date:"d F Y à H:i" }}</b></div>
            </div>
        </div>
        {% endif %}
    {% endif %}


        <input type="hidden" value="{{ parcours.id }}" name="parcours" id="parcours"/>
        {% for rc in relationships_customexercises %}
            {%  if rc.exercise.supportfile.is_title %}     
                <h2 class="listing thin" style="padding-left: 30px; width:100%; clear:both"> 
                    {% if rc.is_header_of_section  %}
                        <a href="#" data-toggle='modal' data-target='#head_of_section' style="color:{{ parcours.color  }}"    data-relation_id='{{ rc.id }}'  class="header_shower" title="Cours associé à cette section">                       
                            {% if  rc.exercise.supportfile.title %}  
                                {{  rc.exercise.supportfile.title|cleanhtml|capfirst }}  
                            {% else %}
                                {{ rc.exercise.supportfile.annoncement|cleanhtml }}
                            {% endif %}   <sup><i class="fa fa-desktop" style="font-size: 9px"></i></sup></a>
                    {% else %}
                        {% if  rc.exercise.supportfile.title %}  
                            {{  rc.exercise.supportfile.title|cleanhtml|capfirst }}  
                        {% else %}
                            {{ rc.exercise.supportfile.annoncement|cleanhtml }}
                        {% endif %}
                    {% endif %}
                </h2>
            {%  elif rc.exercise.supportfile.is_subtitle %}
                <h3 class="listing thin" style="padding-left: 30px; width:100%; clear:both"> 
                    {% if rc.is_header_of_section %}
                        <a href="#" data-toggle='modal' data-target='#head_of_section' style="color:{{ parcours.color  }}"  data-relation_id='{{ rc.id }}' class="header_shower" title="Cours associé à cette sous-section">{{ rc.exercise.supportfile.title|cleanhtml|capfirst }} <sup><i class="fa fa-desktop" style="font-size: 9px"></i></sup></a>
                    {% else %}
                        {{ rc.exercise.supportfile.title|cleanhtml|capfirst }}
                    {% endif %}
                </h3>
            {% else %}  
                {% include 'qcm/details_all_cards.html' %}            
            {% endif %}  
        {% endfor %}

     
     


        {% if relationships_customexercises|length == 0   %}
            {% if parcours.is_folder %}
                <div class="row">
                    <div class="col-sm-12 col-md-1">
                    </div>
                    <div class="col-sm-12 col-md-2" style="margin :40px 0px 0px 0px">
                        <i class="fa fa-folder-open fa-10x" style="color: {{ parcours.color }}"></i>


                        <div >
                            <a href="{% url 'create_parcours' 0 %}"  class="btn btn-default btn-xs" > Créer un parcours personnalisé</a>
                        </div>
                        {% if sacado_asso %}                                  
                        <div>
                            <a href="{% url 'all_parcourses' 0 %}"  class="btn btn-default btn-xs" style="margin-top :10px" > Choisir un parcours mutualisés</a>
                        </div>
                        {% endif  %}

                    </div>
                    <div class="col-sm-12 col-md-9" style="margin :40px 0px 0px 0px">

                        <h1 class="thin" style="color:{{ parcours.color }}" >{{ parcours }} </h1>
                        <div class="row">
                            <div class="col-sm-12 col-md-6" style="margin :40px 0px 0px 0px">
                                <p> contient les parcours suivants : </p>
                                <ul>
                                {% for p in parcours.leaf_parcours.all %}
                                    <li class="sans_puce" style="margin-bottom : 15px">  <a href="{% url 'show_parcours' p.id %}" style="color: {{ p.color }}"><i class="fa fa-th fa-fw fa-small"></i> {{ p }}</a></li>
                                {% endfor %}
                                </ul>
                            </div>
                            <div class="col-sm-12 col-md-6" style="margin :40px 0px 0px 0px">
                                <p> contient les cours suivants : </p>
                                <ul>
                                {% for p in parcours.leaf_parcours.all %}
                                    {% for c in p.course.all %}
                                        <li class="sans_puce">  <a href="{% url 'show_course' c.id c.parcours.id %}" style="color: {{ c.color }}"><i class="fa fa-desktop fa-fw fa-small"></i> {{ c }}</a></li>
                                    {% endfor %}
                                {% endfor %}
                                </ul>
                            </div>
                        </div> 
                    </div>
                </div>


            {% else %}
                <div class="row">
                    <div class="col-sm-3 col-md-3" style="margin:40px">
                    <a href="{% url 'peuplate_parcours' parcours.id   %}" class="btn btn-danger"> Associer des exercices SACADO à {% if parcours.is_evaluation %} cette évaluation {% else %} ce parcours{% endif %}</a>  
                    </div> 
                    <div class="col-sm-3 col-md-3" style="margin:40px">
                    <a href="{% url 'parcours_create_custom_exercise' parcours.id 0  %}" class="btn btn-danger"> Créer un exercice personnalisé dans {% if parcours.is_evaluation %} cette évaluation {% else %} ce parcours{% endif %}</a>  
                    </div> 
                </div> 
            {% endif %}
        {% endif %}



{% if parcours.teacher == teacher %}

    {% if parcours.quizz.count > 0  %}
        <div class="row">
            <div class="col-sm-12 col-md-12">


            
                <hr/>
                <h1 class="thin">Les quizz associés <a href="#" data-toggle='modal' data-target='#quizz_choice' class="size18" ><i class="fa fa-window-restore fa-fw"></i>  Nouveau quizz</a> </h1>


                {% for q in parcours.quizz.all %}
                    <div class="card">

                        <div style="position: absolute; padding: 10px;width:100%; height:80px; background-color: #FFF; opacity:0.85">
                            <a href="{% url 'update_quizz' q.id  %}" target="_blank" style="font-weight: normal;">
                                 {{ q }}  
                            </a>
 
                            <a href="{% url 'create_question' q.id 0  %}" class="pull-right edit">
                                <i class="fa fa-edit pull-right" ></i>
                            </a>     

         
                        {% if group %}
                            <div class="sanspuce historic_li"  style="border:1px solid {{parcours.color}}; border-radius:20px; width:100px;position: absolute; padding:3px; top:50px;left:10px">
                                <a href="{% if q.is_random %}{% url 'show_quizz_random_group'  q.id  group.id %}{% else %}{% url 'show_quizz_group'  q.id  group.id %}{% endif %}" 
                                   style="color:{{group.color}};" 
                                   class="quizz_action {% if q.is_random %} confirm_create_historic{% endif %}" target="_blank" >
                                   <i class="fa fa-play fa-xs"></i>  Papier
                                </a>
                            </div>
                            {% if sacado_asso %}
                                {% if  q.is_video %}
                                <div class="sanspuce historic_li"  style="border:1px solid {{parcours.color}}; border-radius:20px; width:100px;position: absolute; padding:3px; top:80px;left:10px">
                                    <a href="{% url 'play_quizz_teacher'  q.id  group.id  %}" target="_blank"  class="quizz_action" title="En version à tester"
                                        style="color:{{group.color}};"><i class="fa fa-gamepad"></i> Numérique 
                                    </a>  
                                </div>
                                {% elif  q.is_numeric %}
                                <div class="sanspuce historic_li"  style="border:1px solid {{parcours.color}}; border-radius:20px; width:100px;color:{{parcours.color}};position: absolute; padding:3px; top:80px;left:10px">
                                    <a href="{% url 'create_quizz_code'  q.id  group.id  %}#this_quizz{{ q.id }}" target="_blank" class="quizz_action" title="Générer un quizz"
                                        style="color:{{group.color}};"><i class="fa fa-desktop"></i> Numérique
                                    </a>  
                                </div>
                                {% endif %}
                            {% endif %}
                        {% else %}
                            <div class="sanspuce historic_li"  style="color:{{parcours.color}};  width:230px; position: absolute;  top:50px;left:10px">
                                Pour obtenir les liens directs, il faut passer par le tableau de bord et le groupe
                            </div>
                        {% endif %}
                        </div> 
                        {% if q.vignette %}
                            <img src="{{ q.vignette.url }}" width="250px" height="164px"  />
                        {% else %}
                            <img src="{% static 'img/quizz_slide.png' %}" width="250px"   />
                        {% endif %}

                    </div>
                {% endfor %}


            </div>
        </div>  
    {% endif %} 
{% endif %} 






<div class="row">
    <div class="col-sm-12 col-md-12">
        <div class="form-group">
            {% if sacado_asso %}
                {% if parcours.teacher != teacher  and  parcours.is_share %}
                    <a href="{% url 'clone_parcours' parcours.id 0 %}" class="btn btn-primary">Cloner ce parcours </a>    
                    <a href="{% url 'clone_parcours' parcours.id 1 %}" class="btn btn-primary">Cloner ce parcours avec le cours associé</a>  
                {% endif %} 
            {% endif %}  
            <input type="button" value="Retour à la page précédente" class="btn btn-default" onclick="javascript:history.back()"/>
        </div>
    </div>
</div>  






















    </section>
</form>
 




{% if user.is_testeur or user.is_superuser %} 
<div class="modal fade" id="reporting" tabindex="-1" role="dialog" aria-labelledby="reporting"> 
    <div class="modal-dialog" role="document" >
        <div class="modal-content" style="padding-top :0px;">
            <div class="modal-header">
                <h3>Rapport d'erreurs
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> 
                </h3>
            </div>
            <div class="modal-body">
                <form action="{% url 'reporting' %}" method="POST" enctype='multipart/form-data'> 
                  {% csrf_token %} 

                  <label>Rapport d'erreurs</label>        
                    {{ form_reporting.report }}

                    <input name="document" value="parcours" type="hidden" /> 
                    <input name="document_id"  value="{{ parcours.id }}" type="hidden" />
                    <input name="user"  value="{{ user.id }}" type="hidden" />

                    <input class="btn btn-primary" type="submit"/>          
                    <a href="javascript:history.back()"><input type="button" value="Annuler" data-dismiss="modal" aria-label="Close" class="btn btn-default "/></a>
                </form>
            </div>
        </div>
    </div>           
</div>
{% endif %}

 
<div class="modal fade" id="head_of_section" tabindex="-1" role="dialog" aria-labelledby="head_of_section">
    <div class="modal-dialog" role="document"  style="width:95%;">
        <div class="modal-content" style="padding-top :0px;">
            <div class="modal-header">
                <h3>Cours associé
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> 
                </h3>
            </div>
            <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-xs-12">   
                              <div id="courses_from_section"></div>
                        </div>   
                    </div> 
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="remediation" tabindex="-1" role="dialog" aria-labelledby="remediation">
    <div class="modal-dialog" role="document">
        <div class="modal-content" >
             
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> 
                <h2  class='sacado'  >Ajouter une aide, une consigne</h2>
            </div>
            <div class="modal-body">
                <div id="remediation_form">
                </div>
                 <div class="row audio" id="audio" >
                    <form enctype="multipart/form-data" action="" method="post">                    
                        <div class="col-sm-12 col-md-12"> 
                            <label>Audio</label>           
                            <div class="form-group">
                                <div id="controls">
                                    <button type="button" id="recordButton" class="btn btn-danger"><i class="fa fa-microphone"></i></button>
                                    <button type="button" id="pauseButton" disabled  class="btn btn-default"><i class="fa fa-pause"></i> </button>
                                    <button type="button" id="stopButton" disabled  class="btn btn-default"><i class="fa fa-stop"></i></button>
                                </div>
                                <div id="formats"></div>
                                <label><small>Vous pouvez vous enregistrer plusieurs fois pour déterminer la meilleure prise.</small></label>
                                <ol id="recordingsList"></ol>
                                <!-- inserting these scripts at the end to be able to use all the elements in the DOM  -->
                                <script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>
                                <script src="{% static 'js/script/recorder_voice.js' %}"></script>
                            </div>
                        </div>                
                        <input name="id_relationship" id="id_relationship" type="hidden" />
                        <input name="id_parcours" id="id_parcours" type="hidden" value="{{ parcours.id }}" />
                    </form>                    
                </div> 
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="change_parcours" tabindex="-1" role="dialog" aria-labelledby="change_parcours">
    <div class="modal-dialog" role="document" >
        <div class="modal-content" style="padding-top :0px;">
            <form action="{% url 'replace_exercise_into_parcours' %}" method="POST" enctype='multipart/form-data'>
            {% csrf_token %}
                <div class="modal-header">
                    <h3>Déplacer un exercice   
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button> 
                    </h3>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-lg-12 col-xs-12">   
                            <input  name="change_parcours_exercise_id" type="hidden" id="change_parcours_exercise_id"   />
                            <input  name="change_parcours_parcours_id" type="hidden" id="change_parcours_parcours_id"   />
                            <input  name="change_parcours_custom" type="hidden" id="change_parcours_custom"   />                            
                        </div>   
                    </div> 

                    <div class="row">
                        <div class="col-lg-12 col-xs-12">  
                                Si vous souhaitez conserver cet exercice dans le parcours actuel, 
                                cocher aussi le parcours actuel signalé. Sinon l'exercice sera déplacé et n'apparaitra plus dans ce parcours.                       
                        </div>   
                    </div> 
                    <hr/>

                    <div class="row">
                        <div class="col-lg-12 col-xs-12"> 
                            <div class="form-group">
                                {% for p in parcours_group %}

                                   <label> 
                                        <input type="checkbox" name="change_into_parcours" id="change_into_parcours{{ p.id }}"  value="{{ p.id }}" /> 
                                        {% if p.id == parcours.id %}<b>{{ p.title}} <i class="fa fa-hand-o-right"></i> Parcours actuel</b>{% else %} {{ p.title}} {% endif%}
                                    </label>
                                    <br>

                                {% endfor %}
                            </div>
                        </div>   
                    </div> 

                    <div class="row">
                        <div class="col-lg-12 col-xs-12"> 
                            <div class="form-group">
                                <input  value="Déplacer cet exercice dans ces parcours" 
                                        type="submit" class="btn btn-primary" 
                                        onclick="changeExerciceIntoParcours()" />
                                <a href="#" class="btn btn-default" data-dismiss="modal" aria-label="Close">Fermer</a>
                            </div>
                        </div>   
                    </div> 
                </div>
            </form>
        </div>
    </div>
</div>



<div class="modal fade" id="quizz_choice" tabindex="-1" role="dialog" aria-labelledby="quizz_choice">
    <div class="modal-dialog" role="document" style="width: 750px;">
        <div class="modal-content" >
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button> 
                <h1 class='thin'>Création du quizz</h1>
            </div>
            <div class="modal-body">
                <form action="{% url 'create_quizz' %}" method="POST"  enctype='multipart/form-data'>
                    {% include 'tool/form_quizz_items.html' %}
                </form>
            </div>
        </div>
    </div>
</div>



{% endblock %}

 
 
 
 